function changeZoom(){var t=$(".photo-edit")[0].getBoundingClientRect(),e=$(".photo")[0].getBoundingClientRect(),n=$(".photo-edit").css("background-position").split(" "),o=parseInt(n[1])+t.top-e.top,i=parseInt(n[0])+t.left-e.left;$(".photo").css("background-size",$(".photo-edit").css("background-size")),$(".photo").css("background-position",i+"px "+o+"px")}var webCam=function(t,e,n){"use strict";function o(t){var e;e=t.split(",")[0].indexOf("base64")>=0?atob(t.split(",")[1]):unescape(t.split(",")[1]);for(var n=t.split(",")[0].split(":")[1].split(";")[0],o=new Uint8Array(e.length),i=0;i<e.length;i++)o[i]=e.charCodeAt(i);return new Blob([o],{type:n})}var i={id:function(t){return document.getElementById(t)},item:function(t,e){return e?e.querySelector(t):document.querySelector(t)},list:function(t,e){return e?e.querySelector(t):document.querySelectorAll(t)}},a={},e=i.item(e),t=i.item(t),s=0,r=550,c=null,d=null,u=null,l=null,p=null,m=null,g=!1,h=!1,f=null,v={init:function(){n.height&&(r=n.height),u=i.item(".photo-edit",t),c=i.item("#video",t),d=i.item("#canvas",t),l=i.item(".photo-zoom-input",t),p=i.item(".photo-take-discard",t),m=i.item(".photo-save",t),t.dataset.status="waint",v.acessCam(),b.init()},acessCam:function(){navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getMedia({video:!0,audio:!1},function(t){if(navigator.mozGetUserMedia)c.mozSrcObject=t;else{var e=window.URL||window.webkitURL;c.src=e.createObjectURL(t)}c.play(),k.open()},function(t){alert("PermissÃ£o Ã  camera negada"),console.log("An error occured! :"),console.log(t),k.close(),v.destroy()}),c.addEventListener("canplay",v.setDimension,!1)},setDimension:function(t){h||(s=c.videoWidth/(c.videoHeight/r),isNaN(s)&&(s=r*(4/3)),c.setAttribute("height",r),d.setAttribute("height",r),h=!0,t.preventDefault())},takePicture:function(t){var e=d.getContext("2d");if(s&&r){d.width=2*s,d.height=2*r,e.drawImage(c,0,0,2*s,2*r);var n=d.toDataURL("image/png");f=n,$(".photo").cropit("imageSrc",f),"function"==typeof t&&t.call()}},destroy:function(){c.removeEventListener("canplay"),p.removeEventListener("click")}},b={init:function(){p.className="photo-take-discard",p.addEventListener("click",b.takeDiscard),p.dataset.action="take",g=!0,m.addEventListener("click",b.send)},takeDiscard:function(t){if(g&&("take"==this.dataset.action||"discard"==this.dataset.action)){var e=i.item("span",p);return e.addEventListener("webkitAnimationEnd",b.endAnimationTD,!1),e.addEventListener("animationend",b.endAnimationTD,!1),e.addEventListener("oanimationend",b.endAnimationTD,!1),g=!1,"take"==this.dataset.action?b.take(this):b.discard(this)}t.preventDefault()},take:function(e){e.className="photo-take-discard to-discard",e.dataset.action="discard",setTimeout(function(){v.takePicture(function(){t.dataset.status="captured",l.removeAttribute("disabled"),m.removeAttribute("disabled"),i.item("div img",p).src="assets/img/discard.png"})},500)},discard:function(e){e.className="photo-take-discard to-take",e.dataset.action="take",t.dataset.status="waint",l.setAttribute("disabled","on"),m.setAttribute("disabled","on"),$(".photo-edit").css("backgroundImage",""),$(".photo").css("backgroundImage",""),i.item("div img",p).src="assets/img/take.png"},endAnimationTD:function(){this.parentNode.className="photo-take-discard",g=!0},send:function(){var t=$(".photo").cropit("export",{type:"image/jpeg",quality:.9,originalSize:!0}),e=o(t),n=new FormData;n.append("canvasImage",e),m.dataset.status="sending",m.setAttribute("disabled","on"),$.ajax({url:"teste.php",type:"POST",data:n,processData:!1,contentType:!1,error:function(){m.dataset.status="sended",m.removeAttribute("disabled"),alert("Erro no envio, olhar console")}}).done(function(t){console.log(t),m.dataset.status="sended",m.removeAttribute("disabled"),alert("enviou, olhar console"),k.close()})}},k={backgroundOpen:function(t){e.style.display="block",setTimeout(function(){e.className="opening"},10),"function"==typeof t&&t.call()},open:function(){e.className="open"},close:function(){e.className="",setTimeout(function(){e.style.display="none"},1e3)}};return a={open:function(){k.backgroundOpen(function(){v.init()})}}};$(".photo").cropit({onImageLoaded:function(){var t=$(".photo").cropit("offset");$(".photo").cropit("offset",{x:t.x-61,y:t.y}),$(".photo").cropit("zoom",.9),$(".photo").css("background-image",$(".photo-edit").css("background-image")),changeZoom()},onImageError:function(){console.log("erro")}});var onResize=function(){"use strict";var t=50,e=new Date((new Date).getTime()-t),n=function(){changeZoom()};return function(){return e.getTime()+t<=(new Date).getTime()?(e=new Date,n.apply(this,arguments)):void 0}}();window.onload=function(){var t={childList:!1,attributes:!0},e=document.querySelector(".photo-edit"),n=new MutationObserver(onResize);n.observe(e,t);var o=new webCam(".photo","#modalContainer",{height:550});document.getElementById("openModal").addEventListener("click",o.open,!1)};